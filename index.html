<!DOCTYPE html>
<html>
<head>
<title>HYD Bus Tracking Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#0b3d2e; /* Govt Green Base */
    color:white;
}

/* HEADER */
.header{
    padding:18px 25px;
    background:#003366; /* Govt Blue */
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 4px 20px rgba(0,0,0,0.4);
}

.header h1{
    margin:0;
    font-size:20px;
}

/* KPI CARDS */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    padding:20px;
}

.card{
    background:#004d40;
    padding:20px;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
}

.card h2{
    margin:0;
    font-size:28px;
    color:#4dd0e1;
}

/* MAP */
#map{
    height:400px;
    margin:20px;
    border-radius:12px;
    overflow:hidden;
}

/* TABLE */
.table-container{
    padding:20px;
}

table{
    width:100%;
    border-collapse:collapse;
    background:#002b36;
    border-radius:10px;
    overflow:hidden;
}

th{
    background:#003f5c;
    padding:12px;
    text-align:left;
}

td{
    padding:10px;
    border-bottom:1px solid #004d40;
}

tr:hover{
    background:#004d40;
}

.status{
    padding:5px 10px;
    border-radius:15px;
    font-size:12px;
    background:#2e7d32;
}

@media(max-width:768px){
    #map{
        height:300px;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üöç HYD OLECTRA Bus Tracking</h1>
    <div>Live Control Dashboard</div>
</div>

<div class="dashboard">
    <div class="card">
        <h2 id="totalBuses">0</h2>
        <p>Total Buses</p>
    </div>

    <div class="card">
        <h2 id="electricCount">0</h2>
        <p>Electric Buses</p>
    </div>

    <div class="card">
        <h2 id="depotCount">0</h2>
        <p>Total Depots</p>
    </div>
</div>

<div id="map"></div>

<div class="table-container">
<table id="busTable">
    <thead>
        <tr>
            <th>Vehicle No</th>
            <th>Type</th>
            <th>Depot</th>
            <th>Engine</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// üî¥ PASTE YOUR CSV LINK HERE
const sheetURL = "PASTE_YOUR_CSV_LINK_HERE";

// Initialize Map (Hyderabad Center)
var map = L.map('map').setView([17.3850, 78.4867], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap contributors'
}).addTo(map);

fetch(sheetURL)
.then(res=>res.text())
.then(data=>{

    const rows = data.split("\n").map(r=>r.split(","));
    const tableBody = document.querySelector("#busTable tbody");

    let total=0;
    let electric=0;
    let depots=new Set();

    rows.slice(1).forEach(row=>{

        if(row.length<4) return;

        total++;
        if(row[3] && row[3].includes("OLECTRA")) electric++;
        depots.add(row[2]);

        // Add marker (you must add lat,long columns in sheet for real tracking)
        // For now random offset near HYD
        let lat = 17.3 + Math.random()*0.2;
        let lng = 78.4 + Math.random()*0.2;

        L.marker([lat,lng])
         .addTo(map)
         .bindPopup("<b>"+row[0]+"</b><br>"+row[2]);

        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[3]}</td>
            <td><span class="status">Active</span></td>
        `;
        tableBody.appendChild(tr);

    });

    document.getElementById("totalBuses").textContent=total;
    document.getElementById("electricCount").textContent=electric;
    document.getElementById("depotCount").textContent=depots.size;

});

</script>

</body>
</html>
