<!DOCTYPE html>
<html>
<head>
<title>HYD Bus Tracking Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#0b3d2e;
    color:white;
}

/* HEADER */
.header{
    padding:18px 25px;
    background:#003366;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.header h1{
    margin:0;
    font-size:20px;
}

/* KPI */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    padding:20px;
}

.card{
    background:#004d40;
    padding:20px;
    border-radius:12px;
}

.card h2{
    margin:0;
    font-size:26px;
    color:#4dd0e1;
}

/* SEARCH */
.search-box{
    padding:0 20px 10px 20px;
}

.search-box input{
    padding:10px;
    width:250px;
    border-radius:6px;
    border:none;
}

/* MAP */
#map{
    height:400px;
    margin:20px;
    border-radius:12px;
}

/* TABLE */
.table-container{
    padding:20px;
}

table{
    width:100%;
    border-collapse:collapse;
    background:#002b36;
}

th{
    background:#003f5c;
    padding:12px;
}

td{
    padding:10px;
    border-bottom:1px solid #004d40;
}

tr:hover{
    background:#004d40;
}

.status{
    padding:4px 10px;
    border-radius:15px;
    background:#2e7d32;
    font-size:12px;
}
</style>
</head>

<body>

<div class="header">
    <h1>üöç Hyderabad City Bus Tracking</h1>
    <div>Live Control Dashboard</div>
</div>

<div class="dashboard">
    <div class="card">
        <h2 id="totalBuses">0</h2>
        <p>Total Buses</p>
    </div>
    <div class="card">
        <h2 id="electricCount">0</h2>
        <p>Electric Buses</p>
    </div>
    <div class="card">
        <h2 id="depotCount">0</h2>
        <p>Total Depots</p>
    </div>
</div>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="Search Vehicle Number...">
</div>

<div id="map"></div>

<div class="table-container">
<table id="busTable">
<thead>
<tr>
<th>Vehicle No</th>
<th>Type</th>
<th>Depot</th>
<th>Engine</th>
<th>Status</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// üî¥ PUT YOUR GOOGLE SHEET CSV LINK HERE
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQFABE9Tm8vvxKX4E93wHg1U8Nq7NmbiWdkfc1mVC0zz69eJFKuQn-FE0PtHDzN4TtbGjhUPFYWbhF0/pub?output=csv";
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQFABE9Tm8vvxKX4E93wHg1U8Nq7NmbiWdkfc1mVC0zz69eJFKuQn-FE0PtHDzN4TtbGjhUPFYWbhF0/pub?gid=1059533786&single=true&output=csv";
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQFABE9Tm8vvxKX4E93wHg1U8Nq7NmbiWdkfc1mVC0zz69eJFKuQn-FE0PtHDzN4TtbGjhUPFYWbhF0/pub?gid=1785828637&single=true&output=csv";

var map = L.map('map').setView([17.3850, 78.4867], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap contributors'
}).addTo(map);

let markers = [];

fetch(sheetURL)
.then(res=>res.text())
.then(data=>{

    const rows = data.split("\n").map(r=>r.split(","));
    const tableBody = document.querySelector("#busTable tbody");

    let total=0;
    let electric=0;
    let depots=new Set();

    rows.slice(1).forEach(row=>{

        if(row.length<4) return;

        total++;
        if(row[3] && row[3].includes("OLECTRA")) electric++;
        depots.add(row[2]);

        let lat = 17.3 + Math.random()*0.2;
        let lng = 78.4 + Math.random()*0.2;

        let marker = L.marker([lat,lng])
        .addTo(map)
        .bindPopup("<b>"+row[0]+"</b><br>"+row[2]);

        markers.push({vehicle:row[0], marker:marker});

        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[3]}</td>
            <td><span class="status">Active</span></td>
        `;
        tableBody.appendChild(tr);
    });

    document.getElementById("totalBuses").textContent=total;
    document.getElementById("electricCount").textContent=electric;
    document.getElementById("depotCount").textContent=depots.size;
});

// VEHICLE SEARCH
document.getElementById("searchInput").addEventListener("keyup", function(){

    let value=this.value.toLowerCase();
    let rows=document.querySelectorAll("#busTable tbody tr");

    rows.forEach(row=>{
        row.style.display=row.innerText.toLowerCase().includes(value) ? "" : "none";
    });

    markers.forEach(obj=>{
        if(obj.vehicle.toLowerCase().includes(value)){
            obj.marker.openPopup();
            map.setView(obj.marker.getLatLng(), 12);
        }
    });

});

</script>

</body>
</html>


